<html>

<head>
	<script src="https://surikov.github.io/riffplay/riffplay_module.js"></script>
	<script src="https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/0300_LesPaul_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/0280_LesPaul_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/0250_Chaos_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/0170_SBLive_sf2.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/0001_FluidR3_GM_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/0340_Aspirin_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/0390_GeneralUserGS_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/0490_Chaos_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/12835_0_Chaos_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/12838_22_FluidR3_GM_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/12841_26_JCLive_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/12842_26_JCLive_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/12845_26_JCLive_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/12846_26_JCLive_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/12849_26_JCLive_sf2_file.js"></script>
	<script src="https://surikov.github.io/webaudiofontdata/sound/12851_26_JCLive_sf2_file.js"></script>
</head>

<body>
	<h1>proceduralgeneration</h1>

	<p>Progression <span id="infoProgression">X</span></p>
	<p>
		<input style="width: 100%;" type="range" min="0" max="999" value="0" id="sliderProgression"
			onChange='parsChanged();'>
	</p>

	<p>Drum <span id="infoDrum">X</span></p>
	<p>
		<input style="width: 100%;" type="range" min="0" max="999" value="0" id="sliderDrum"
			onChange='parsChanged();'>
	</p>

	<p>Bass <span id="infoBass">X</span></p>
	<p>
		<input style="width: 100%;" type="range" min="0" max="999" value="0" id="sliderBass"
			onChange='parsChanged();'>
	</p>

	<p>Piano/Strum/Riff rhythm <span id="infoRhythm">X</span></p>
	<p>
		<input style="width: 100%;" type="range" min="0" max="999" value="0" id="sliderRhythm"
			onChange='parsChanged();'>
	</p>

	<p>Pad <span id="infoPad">X</span></p>
	<p>
		<input style="width: 100%;" type="range" min="0" max="999" value="0" id="sliderPad" onChange='parsChanged();'>
	</p>

	<p>Melody <span id="infoMelody">X</span></p>
	<p>
		<input style="width: 100%;" type="range" min="0" max="999" value="0" id="sliderMelody"
			onChange='parsChanged();'>
	</p>

	<p><a id='proceduralgeneration' href='javascript:test();'>launch</p>
	<p><a id='startPlay' href='javascript:startPlay();'>startPlay</p>
	<p><a id='pausePlay' href='javascript:pausePlay();'>pausePlay</p>

	<script type='text/javascript' src='r2.js'></script>
	<script type='text/javascript'>
		console.log('init');
		var genRiff = new GenRiff();
		

		var progNN=0;
		var drumNN=0;
		var bassNN=0;
		var padNN=0;
		var rhNN=0;
		var meloNN=0;

		function updateColors(){
			var nn = 1 * document.getElementById('sliderProgression').value;
			var r=Math.floor(255 * nn / 1000);
			var color='rgb('+r+',127,127)';
			document.getElementById("infoProgression").style.color = color;
			//console.log(color);
		}
		function setInfo(infoName, valueName, arr) {
			var sz = arr.length;
			var nn = 1 * document.getElementById(valueName).value;
			var r=Math.floor(sz * nn / 1000);
			document.getElementById(infoName).innerHTML = '' +r+': '+arr[r].category+' / '+arr[r].name;
			return r;
		}

		function parsChanged() {
			progNN=setInfo('infoProgression', 'sliderProgression', genRiff.progressions);
			drumNN=setInfo('infoDrum', 'sliderDrum', genRiff.drumsDefs);
			bassNN=setInfo('infoBass', 'sliderBass', genRiff.bassDefs);
			rhNN=setInfo('infoRhythm', 'sliderRhythm', genRiff.rhythmDefsData);
			padNN=setInfo('infoPad', 'sliderPad', genRiff.padDefsData);
			meloNN=setInfo('infoMelody', 'sliderMelody', genRiff.melodyDefsData);
			updateColors();
			genRiff.playInfo = genRiff.generateAll(progNN, drumNN, bassNN, rhNN, padNN,meloNN);
		}
		function startPlay(){
			genRiff.initAudio();
			genRiff.startPlay(progNN, drumNN, bassNN, rhNN, padNN,meloNN);
			return null;
		}
		function pausePlay(){
			
			genRiff.pausePlay();
			return null;
		}
		function test() {
			parsChanged();
			//console.log(genRiff.generate(progNN, drumNN, bassNN, rhNN, padNN,meloNN));
			var urlprj=genRiff.generate(progNN, drumNN, bassNN, rhNN, padNN,meloNN);
			console.log(urlprj);
			window.open(urlprj);
			return null;
		}

		parsChanged();
	</script>
</body>

</html>